# bertopicr

Topic modeling in R via `reticulate` + the Python `BERTopic` ecosystem
(version 0.17.x). Provides helpers for topic inspection and
visualization; see the [Quarto
notebook](https://github.com/tpetric7/bertopicr/blob/main/inst/extdata/topics_spiegel.qmd)
and the
[vignettes](https://github.com/tpetric7/bertopicr/blob/main/vignettes/topics_spiegel.Rmd)
for an end-to-end training workflow.

![Visualize topics in the
documents](articles/images/visualize_documents.png)

## Installation (R package)

``` r
install.packages("devtools")
devtools::install_github("tpetric7/bertopicr")
```

## Python environment setup (pick one)

**A. Virtualenv (base Python)**

``` bash
python -m venv r-bertopic

# Windows
r-bertopic\Scripts\activate

# macOS/Linux
source r-bertopic/bin/activate

pip install --upgrade pip
pip install -r inst/requirements.txt
```

**B. Conda**

``` bash
conda create -n r-bertopic python=3.10
conda activate r-bertopic
pip install -r inst/requirements.txt
```

(Requirements are bundled at `inst/requirements.txt`. If you have a GPU,
install a matching CUDA build of PyTorch in the same env,
e.g. `pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118`.)

**C. Install via reticulate (inside R)**

``` r
library(reticulate)
# Choose ONE of these depending on what you created
target_env <- "r-bertopic"
use_virtualenv(target_env, required = TRUE)      # for virtualenv
# use_condaenv(target_env, required = TRUE)      # for conda

req <- system.file("requirements.txt", package = "bertopicr")
py_install(packages = c("-r", req), envname = target_env, method = "auto", pip = TRUE)
py_config()  # confirm reticulate sees the chosen env
```

## Minimal usage (fit + visualize)

The package focuses on post-fit helpers. Use your preferred BERTopic
training code (see the Quarto notebook for a full pipeline), then pass
the Python model and outputs into these functions.

``` r
library(reticulate)
library(bertopicr)

# Point reticulate to the env you prepared
use_virtualenv("r-bertopic", required = TRUE)
# use_condaenv("r-bertopic", required = TRUE)

# Example: fit a simple model in Python-land
bertopic <- import("bertopic")
np <- import("numpy")
sentencetransformers <- import("sentence_transformers")
embedder <- sentencetransformers$SentenceTransformer("BAAI/bge-m3")
texts <- c("Cats are great pets", "Dogs are loyal companions", "The stock market fluctuates")
embeddings <- embedder$encode(texts, show_progress_bar = FALSE)
model <- bertopic$BERTopic(calculate_probabilities = TRUE)
fit <- model$fit_transform(texts, embeddings)
topics <- fit[[1]]
probs <- fit[[2]]

# Use the R helpers
visualize_topics(model, filename = "intertopic_distance_map", auto_open = FALSE)
visualize_distribution(model, text_id = 1, probabilities = probs, auto_open = FALSE)
```

## Advanced example

See the
[vignettes](https://github.com/tpetric7/bertopicr/blob/main/vignettes/topics_spiegel.Rmd)
or the [Quarto
tutorial](https://github.com/tpetric7/bertopicr/blob/main/inst/extdata/topics_spiegel.qmd)
and the[HTML
document](https://github.com/tpetric7/bertopicr/blob/main/inst/extdata/topics__spiegel.html)
for a complete workflow (training, representation models \[keyBERT,
ollama models, …\], dimensionality reduction, clustering, and
visualizations).

## Sample visualizations

![Intertopic distance map](articles/images/intertopic_distance_map.png)

![Topics over time](articles/images/topics_over_time.png)

![Topics similarity
heatmap](articles/images/topics_similarity_heatmap.png)

## Citation

`BERTopic` is described in:

``` bibtex
@article{grootendorst2022bertopic,
  title={BERTopic: Neural topic modeling with a class-based TF-IDF procedure},
  author={Grootendorst, Maarten},
  journal={arXiv preprint arXiv:2203.05794},
  year={2022}
}
```

## License

This package is licensed under the MIT License. You are free to use,
modify, and distribute this software, provided that proper attribution
is given to the original author.

# Package index

## All functions

- [`find_topics_df()`](https://tpetric7.github.io/bertopicr/reference/find_topics_df.md)
  : Find Topics DataFrame Function
- [`get_document_info_df()`](https://tpetric7.github.io/bertopicr/reference/get_document_info_df.md)
  : Get Document Information DataFrame
- [`get_most_representative_docs()`](https://tpetric7.github.io/bertopicr/reference/get_most_representative_docs.md)
  : Get Most Representative Documents for a Specific Topic
- [`get_representative_docs_custom()`](https://tpetric7.github.io/bertopicr/reference/get_representative_docs_custom.md)
  : Get Representative Documents for a Specific Topic
- [`get_topics_df()`](https://tpetric7.github.io/bertopicr/reference/get_topics_df.md)
  : Get Topics DataFrame Function
- [`get_topic_df()`](https://tpetric7.github.io/bertopicr/reference/get_topic_df.md)
  : Get Topic DataFrame Function
- [`get_topic_info_df()`](https://tpetric7.github.io/bertopicr/reference/get_topic_info_df.md)
  : Get Topic Information DataFrame
- [`setup_python_environment()`](https://tpetric7.github.io/bertopicr/reference/setup_python_environment.md)
  : Set Up Python Environment for BERTopic
- [`visualize_barchart()`](https://tpetric7.github.io/bertopicr/reference/visualize_barchart.md)
  : Visualize BERTopic Bar Chart
- [`visualize_distribution()`](https://tpetric7.github.io/bertopicr/reference/visualize_distribution.md)
  : Visualize Topic Distribution for a Specific Document using BERTopic
- [`visualize_documents()`](https://tpetric7.github.io/bertopicr/reference/visualize_documents.md)
  : Visualize Documents in Reduced Embedding Space
- [`visualize_documents_3d()`](https://tpetric7.github.io/bertopicr/reference/visualize_documents_3d.md)
  : Visualize Documents in 3D Space using BERTopic
- [`visualize_heatmap()`](https://tpetric7.github.io/bertopicr/reference/visualize_heatmap.md)
  : Visualize Topic Similarity Heatmap using BERTopic
- [`visualize_hierarchy()`](https://tpetric7.github.io/bertopicr/reference/visualize_hierarchy.md)
  : Visualize Topic Hierarchy Nodes using BERTopic
- [`visualize_topics()`](https://tpetric7.github.io/bertopicr/reference/visualize_topics.md)
  : Visualize Topics using BERTopic
- [`visualize_topics_over_time()`](https://tpetric7.github.io/bertopicr/reference/visualize_topics_over_time.md)
  : Visualize Topics Over Time using BERTopic
- [`visualize_topics_per_class()`](https://tpetric7.github.io/bertopicr/reference/visualize_topics_per_class.md)
  : Visualize Topics per Class

# Articles

### All vignettes

- [Topic Modeling with BERTopic in R using reticulate and local
  LLMs](https://tpetric7.github.io/bertopicr/articles/topics_spiegel.md):
