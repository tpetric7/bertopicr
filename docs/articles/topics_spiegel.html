<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Topic Modeling with BERTopic in R using reticulate and local LLMs • bertopicr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Topic Modeling with BERTopic in R using reticulate and local LLMs">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bertopicr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/topics_spiegel.html">Topic Modeling with BERTopic in R using reticulate and local LLMs</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Topic Modeling with BERTopic in R using reticulate and local LLMs</h1>
            
      

      <div class="d-none name"><code>topics_spiegel.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="view-pre-computed-results">View Pre-Computed Results<a class="anchor" aria-label="anchor" href="#view-pre-computed-results"></a>
</h2>
<p><strong>Note:</strong> The code below requires a specific Python
environment. If you simply want to view the full tutorial with all
interactive graphs and results, run the following command in R:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Open the pre-computed HTML tutorial in your browser</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/browseURL.html" class="external-link">browseURL</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"topics__spiegel.html"</span>, package <span class="op">=</span> <span class="st">"bertopicr"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The package <code>bertopicr</code> is based on the Python package
<code>BERTopic</code> by Maarten Grootendorst (<a href="https://github.com/MaartenGr/BERTopic" class="external-link uri">https://github.com/MaartenGr/BERTopic</a>), which is
described in his paper:</p>
<blockquote>
<p><strong>BERTopic: Neural topic modeling with a class-based TF-IDF
procedure</strong><br>
Maarten Grootendorst, 2022.<br>
Available at: <a href="https://arxiv.org/abs/2203.05794" class="external-link">arXiv:2203.05794</a></p>
</blockquote>
<p>The package <code>bertopicr</code> introduces functions to display
topic model results of <code>BERTopic</code> models in <code>R</code>.
The <code>R</code> package was created with the programming support of
<code>OpenAI</code>’s model <code>GPT4o</code>.</p>
</div>
<div class="section level2">
<h2 id="environment-preparation">Environment preparation<a class="anchor" aria-label="anchor" href="#environment-preparation"></a>
</h2>
<div class="section level3">
<h3 id="r-packages">R packages<a class="anchor" aria-label="anchor" href="#r-packages"></a>
</h3>
<p><em>Load</em> the <code>R</code> packages below and
<em>initialize</em> a <code>Python</code> environment with the
<code>reticulate</code> package.</p>
<p>By default, <code>reticulate</code> uses an isolated
<code>Python</code> <em>virtual environment</em> named
<code>r-reticulate</code> (cf. <a href="https://rstudio.github.io/reticulate/" class="external-link uri">https://rstudio.github.io/reticulate/</a>).</p>
<p>The <code><a href="https://rstudio.github.io/reticulate/reference/use_python.html" class="external-link">use_python()</a></code> and the <code><a href="https://rstudio.github.io/reticulate/reference/use_python.html" class="external-link">use_virtualenv()</a></code>
functions below enable you to specify an alternate <code>Python</code>
environment (cf. <a href="https://rstudio.github.io/reticulate/" class="external-link uri">https://rstudio.github.io/reticulate/</a>).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">utils</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jabiru/tictoc" class="external-link">tictoc</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/htmltools" class="external-link">htmltools</a></span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/reticulate/" class="external-link">reticulate</a></span><span class="op">)</span></span></code></pre></div>
<p>Avoid loading conflicting <code>R</code> libraries like
<code>arrow</code> and <code>plotly</code> alongside with
<code>Python</code> modules <code>BERTopic</code>, <code>pyarrow</code>
and <code>plotly</code>.</p>
</div>
<div class="section level3">
<h3 id="python-packages">Python packages<a class="anchor" aria-label="anchor" href="#python-packages"></a>
</h3>
<p>Before running the program chunk below, make sure to <em>install</em>
all the necessary <code>Python</code> packages in a <code>virtual</code>
environment or a <code>conda</code> environment (see short instructions
in the README file or other tutorials online):
<code>bertopic, numpy, scikit-learn, sentence-transformers, umap-learn, hdbscan, spacy, openai</code>
and <code>datetime</code>. Download and install <code>ollama</code> or
<code>lm-studio</code> on your computer to serve <em>local</em> language
models.</p>
<p>In <code>RStudio</code>, you can accomplish the installation of
<code>Python</code> packages with <code>reticulate</code> commands:
e.g.,
<code>reticulate::py_install ("bertopic", envname = "CHOOSE THE PATH YOUR PYTHON ENVIRONMENT")</code>.</p>
<p>If you are familiar working with a <code>terminal</code>, you can
activate the appropriate <code>python</code> or <code>conda</code>
environment and install the necessary packages (e.g.,
<code>pip install bertopic</code>).</p>
<p>After environment preparation and package installation, we
<code>import</code> the <code>Python</code> packages we will be using
for topic modelling, most of them in the programming chunk below, other
during model preparation.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Import necessary Python modules</span></span>
<span><span class="va">py</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/reticulate/reference/import.html" class="external-link">import_builtins</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">np</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/reticulate/reference/import.html" class="external-link">import</a></span><span class="op">(</span><span class="st">"numpy"</span><span class="op">)</span></span>
<span><span class="va">umap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/reticulate/reference/import.html" class="external-link">import</a></span><span class="op">(</span><span class="st">"umap"</span><span class="op">)</span></span>
<span><span class="va">UMAP</span> <span class="op">&lt;-</span> <span class="va">umap</span><span class="op">$</span><span class="va">UMAP</span></span>
<span><span class="va">hdbscan</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/reticulate/reference/import.html" class="external-link">import</a></span><span class="op">(</span><span class="st">"hdbscan"</span><span class="op">)</span></span>
<span><span class="va">HDBSCAN</span> <span class="op">&lt;-</span> <span class="va">hdbscan</span><span class="op">$</span><span class="va">HDBSCAN</span></span>
<span><span class="va">sklearn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/reticulate/reference/import.html" class="external-link">import</a></span><span class="op">(</span><span class="st">"sklearn"</span><span class="op">)</span></span>
<span><span class="va">CountVectorizer</span> <span class="op">&lt;-</span> <span class="va">sklearn</span><span class="op">$</span><span class="va">feature_extraction</span><span class="op">$</span><span class="va">text</span><span class="op">$</span><span class="va">CountVectorizer</span></span>
<span><span class="va">bertopic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/reticulate/reference/import.html" class="external-link">import</a></span><span class="op">(</span><span class="st">"bertopic"</span><span class="op">)</span></span>
<span><span class="va">plotly</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/reticulate/reference/import.html" class="external-link">import</a></span><span class="op">(</span><span class="st">"plotly"</span><span class="op">)</span></span>
<span><span class="va">datetime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/reticulate/reference/import.html" class="external-link">import</a></span><span class="op">(</span><span class="st">"datetime"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="text-preparation">Text preparation<a class="anchor" aria-label="anchor" href="#text-preparation"></a>
</h2>
<p>The <em>German texts</em> are in the <em>text_clean</em> column. They
were segmented into smaller chunks (each about 100 tokens long) to
optimize topic extraction with <code>bertopicr</code>. Special
characters were removed with a cleaning function. The text chunks are
all in lower case.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rds_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"inst/extdata"</span>, <span class="st">"spiegel_sample.rds"</span><span class="op">)</span></span>
<span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">read_rds</a></span><span class="op">(</span><span class="va">rds_path</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span></span></code></pre></div>
<p>The collected <code>stopword</code> list includes German and English
tokens and will be inserted into <code>Python</code>’s
<code>CountVectorizer</code> before <code>TF-IDF</code> calculation. The
language model will process the text chunks in the <em>text_clean</em>
column before <code>stopword</code> removal.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stopwords_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"inst/extdata"</span>, <span class="st">"all_stopwords.txt"</span><span class="op">)</span></span>
<span><span class="va">all_stopwords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_lines.html" class="external-link">read_lines</a></span><span class="op">(</span><span class="va">stopwords_path</span><span class="op">)</span></span></code></pre></div>
<p>Below are the lists of <em>texts_cleaned</em> and <em>timesteps</em>,
which we need during model preparation, topic extraction and
visualization.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">texts_cleaned</span> <span class="op">=</span> <span class="va">dataset</span><span class="op">$</span><span class="va">text_clean</span></span>
<span><span class="va">titles</span> <span class="op">=</span> <span class="va">dataset</span><span class="op">$</span><span class="va">doc_id</span></span>
<span><span class="va">timestamps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">date</span><span class="op">)</span></span>
<span><span class="co"># timestamps &lt;- as.integer(dataset$year)</span></span>
<span></span>
<span><span class="va">texts_cleaned</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model-preparation">Model Preparation<a class="anchor" aria-label="anchor" href="#model-preparation"></a>
</h2>
<p>For model preparation, we are going to use <code>reticulate</code> to
interface with <code>Python</code> modules. The <code>R</code> code is
essentially a conversion of <code>Python</code> code.</p>
<p>The Topic model preparation will also include <em>local</em> language
models (via <code>ollama</code> or <code>lm-studio</code>) leveraging
the <code>OpenAI</code> endpoint.</p>
<div class="section level3">
<h3 id="embeddings">Embeddings<a class="anchor" aria-label="anchor" href="#embeddings"></a>
</h3>
<p><code>SentenceTransformer</code> creates the necessary
<em>embeddings</em> (vector representations of text tokens) for topic
modeling with <code>bertopic</code>. The first time
<code>SentenceTransformer</code> is used with a specific model, the
model has to been downloaded from the <code>huggingface</code> website
(<a href="https://huggingface.co/" class="external-link uri">https://huggingface.co/</a>), where many freely usable
language models are hosted (<a href="https://huggingface.co/models" class="external-link uri">https://huggingface.co/models</a>).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Embed the sentences</span></span>
<span><span class="va">sentence_transformers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/reticulate/reference/import.html" class="external-link">import</a></span><span class="op">(</span><span class="st">"sentence_transformers"</span><span class="op">)</span></span>
<span><span class="va">SentenceTransformer</span> <span class="op">&lt;-</span> <span class="va">sentence_transformers</span><span class="op">$</span><span class="va">SentenceTransformer</span></span>
<span><span class="co"># choose an appropriate embeddings model</span></span>
<span><span class="va">embedding_model</span> <span class="op">=</span> <span class="fu">SentenceTransformer</span><span class="op">(</span><span class="st">"Qwen/Qwen3-Embedding-0.6B"</span><span class="op">)</span></span>
<span><span class="va">embeddings</span> <span class="op">=</span> <span class="va">embedding_model</span><span class="op">$</span><span class="fu">encode</span><span class="op">(</span><span class="va">texts_cleaned</span>, show_progress_bar<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="dimension-reduction">Dimension reduction<a class="anchor" aria-label="anchor" href="#dimension-reduction"></a>
</h3>
<p>In the next two steps, the <code>umap</code> module reduces the
number of dimensions of embeddings, and the <code>hdbscan</code> module
extracts clusters that can evaluated by the topic pipeline.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Initialize UMAP and HDBSCAN models</span></span>
<span><span class="va">umap_model</span> <span class="op">&lt;-</span> <span class="fu">UMAP</span><span class="op">(</span>n_neighbors<span class="op">=</span><span class="fl">15L</span>, n_components<span class="op">=</span><span class="fl">5L</span>, min_dist<span class="op">=</span><span class="fl">0.0</span>, metric<span class="op">=</span><span class="st">'cosine'</span>, random_state<span class="op">=</span><span class="fl">42L</span><span class="op">)</span></span></code></pre></div>
<p>Other dimension reduction methods (like <code>PCA</code> or
<code>tSNE</code>) can be used instead.</p>
</div>
<div class="section level3">
<h3 id="clustering">Clustering<a class="anchor" aria-label="anchor" href="#clustering"></a>
</h3>
<p>The <code>hdbscan</code> module extracts clusters that can be
evaluated by the topic pipeline. Starting with BERTopic version 0.17.0,
I had to decrease the number of parallel workers to
<code>core_dist_n_jobs</code> = 1 to avoid out of memory error messages
on my <code>Windows</code> PC.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hdbscan_model</span> <span class="op">&lt;-</span> <span class="fu">HDBSCAN</span><span class="op">(</span>min_cluster_size<span class="op">=</span><span class="fl">50L</span>, min_samples <span class="op">=</span> <span class="fl">20L</span>, metric<span class="op">=</span><span class="st">'euclidean'</span>, cluster_selection_method<span class="op">=</span><span class="st">'eom'</span>, gen_min_span_tree<span class="op">=</span><span class="cn">TRUE</span>, prediction_data<span class="op">=</span><span class="cn">TRUE</span>, core_dist_n_jobs <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>Other <code>clustering</code> methods (like <code>kmeans</code>) can
be used instead.</p>
</div>
<div class="section level3">
<h3 id="c-tf-idf">c-TF-IDF<a class="anchor" aria-label="anchor" href="#c-tf-idf"></a>
</h3>
<p>The <code>Countvectorizer</code> calculates the <code>c-TF-IDF</code>
frequencies and enables the <code>representation model</code> defined
below to extract suitable keywords as descriptors of the extracted
topics.</p>
<p><code>Stopwords</code> are removed <em>after</em> creating
<code>embeddings</code>, but <em>before</em> <code>keyword</code>
extraction. Stopword removal is accomplished with the
<code>CountVectorizer</code> method.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Initialize CountVectorizer</span></span>
<span><span class="va">vectorizer_model</span> <span class="op">&lt;-</span> <span class="fu">CountVectorizer</span><span class="op">(</span>min_df<span class="op">=</span><span class="fl">2L</span>, ngram_range<span class="op">=</span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/tuple.html" class="external-link">tuple</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">3L</span><span class="op">)</span>, </span>
<span>                                    max_features <span class="op">=</span> <span class="fl">10000L</span>, max_df <span class="op">=</span> <span class="fl">50L</span>,</span>
<span>                                    stop_words <span class="op">=</span> <span class="va">all_stopwords</span><span class="op">)</span></span>
<span><span class="va">sentence_vectors</span> <span class="op">&lt;-</span> <span class="va">vectorizer_model</span><span class="op">$</span><span class="fu">fit_transform</span><span class="op">(</span><span class="va">texts_cleaned</span><span class="op">)</span></span>
<span><span class="va">sentence_vectors_dense</span> <span class="op">&lt;-</span> <span class="va">np</span><span class="op">$</span><span class="fu">array</span><span class="op">(</span><span class="va">sentence_vectors</span><span class="op">)</span></span>
<span><span class="va">sentence_vectors_dense</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/reticulate/reference/r-py-conversion.html" class="external-link">py_to_r</a></span><span class="op">(</span><span class="va">sentence_vectors_dense</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="representation-models">Representation models<a class="anchor" aria-label="anchor" href="#representation-models"></a>
</h3>
<p>In the example below, <em>multiple representation models</em> are
used for keyword extraction from the identified topics and topic
description: <code>keyBERT</code> (part of <code>bertopic</code>), a
language model (served locally by <code>ollama</code> via the
<code>OpenAI</code> endpoint, but it is also possible to use models from
<code>Groq</code> or other providers), a Maximal Marginal Relevance
model (<code>MMR</code>) and a <code>spacy</code> <code>POS</code>
representation model. By default, only one Representation model is
created by <code>bertopic</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Initialize representation models</span></span>
<span><span class="va">keybert_model</span> <span class="op">&lt;-</span> <span class="va">bertopic</span><span class="op">$</span><span class="va">representation</span><span class="op">$</span><span class="fu">KeyBERTInspired</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">openai</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/reticulate/reference/import.html" class="external-link">import</a></span><span class="op">(</span><span class="st">"openai"</span><span class="op">)</span></span>
<span><span class="va">OpenAI</span> <span class="op">&lt;-</span> <span class="va">openai</span><span class="op">$</span><span class="va">OpenAI</span></span>
<span><span class="va">ollama</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/reticulate/reference/import.html" class="external-link">import</a></span><span class="op">(</span><span class="st">"ollama"</span><span class="op">)</span></span>
<span><span class="co"># lmstudio &lt;- import("lmstudio")</span></span>
<span></span>
<span><span class="co"># Point to the local server (ollama or lm-studio)</span></span>
<span><span class="va">client</span> <span class="op">&lt;-</span> <span class="fu">OpenAI</span><span class="op">(</span>base_url <span class="op">=</span> <span class="st">'http://localhost:11434/v1'</span>, api_key<span class="op">=</span><span class="st">'ollama'</span><span class="op">)</span></span>
<span><span class="co"># client &lt;- OpenAI(base_url = 'http://localhost:1234/v1', api_key='lm-studio')</span></span>
<span></span>
<span><span class="va">prompt</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">I have a topic that contains the following documents:</span></span>
<span><span class="st">[DOCUMENTS]</span></span>
<span><span class="st">The topic is described by the following keywords: [KEYWORDS]</span></span>
<span><span class="st"></span></span>
<span><span class="st">Based on the information above, extract a short but highly descriptive topic label of at most 5 words. Make sure it is in the following format:</span></span>
<span><span class="st">topic: &lt;topic label&gt;</span></span>
<span><span class="st">"</span></span>
<span></span>
<span><span class="co"># download an appropriate LLM to be hosted by ollama or lm-studio</span></span>
<span><span class="va">openai_model</span> <span class="op">&lt;-</span> <span class="va">bertopic</span><span class="op">$</span><span class="va">representation</span><span class="op">$</span><span class="fu">OpenAI</span><span class="op">(</span><span class="va">client</span>, </span>
<span>                                               model <span class="op">=</span> <span class="st">"ministral-3:14b"</span>,</span>
<span>                                               exponential_backoff <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                                               chat <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                                               prompt <span class="op">=</span> <span class="va">prompt</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># downlaod a language model from spacy.io before use here</span></span>
<span><span class="co"># Below a German spacy model is used</span></span>
<span><span class="va">pos_model</span> <span class="op">&lt;-</span> <span class="va">bertopic</span><span class="op">$</span><span class="va">representation</span><span class="op">$</span><span class="fu">PartOfSpeech</span><span class="op">(</span><span class="st">"de_core_news_lg"</span><span class="op">)</span></span>
<span><span class="co"># diversity set relatively high to reduce repetition of keyword word forms</span></span>
<span><span class="va">mmr_model</span> <span class="op">&lt;-</span> <span class="va">bertopic</span><span class="op">$</span><span class="va">representation</span><span class="op">$</span><span class="fu">MaximalMarginalRelevance</span><span class="op">(</span>diversity <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine all representation models</span></span>
<span><span class="va">representation_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"KeyBERT"</span> <span class="op">=</span> <span class="va">keybert_model</span>,</span>
<span>  <span class="st">"OpenAI"</span> <span class="op">=</span> <span class="va">openai_model</span>,</span>
<span>  <span class="st">"MMR"</span> <span class="op">=</span> <span class="va">mmr_model</span>,</span>
<span>  <span class="st">"POS"</span> <span class="op">=</span> <span class="va">pos_model</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The <em>prompt</em> describes the task the language model has to
accomplish, mentions the documents to work with and the topic labels
that it should derive from the text contents and keywords.</p>
</div>
<div class="section level3">
<h3 id="zeroshot-keywords">Zeroshot keywords<a class="anchor" aria-label="anchor" href="#zeroshot-keywords"></a>
</h3>
<p><code>Bertopic</code> enables us to define a <code>zeroshot</code>
list of keywords that can be used to drive the topic model towards
desired topic outcomes. In the topic model below, the zeroshot keyword
list is disabled, but can be activated if needed.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We can define a number of topics of interest </span></span>
<span><span class="va">zeroshot_topic_list</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"german national identity"</span>, <span class="st">"minority issues in germany"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="topic-model">Topic Model<a class="anchor" aria-label="anchor" href="#topic-model"></a>
</h3>
<p>In the next step, we initialize the BERTopic model pipeline and
hyperparameters.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Initialize BERTopic model with pipeline models and hyperparameters</span></span>
<span><span class="va">BERTopic</span> <span class="op">&lt;-</span> <span class="va">bertopic</span><span class="op">$</span><span class="va">BERTopic</span></span>
<span><span class="va">topic_model</span> <span class="op">&lt;-</span> <span class="fu">BERTopic</span><span class="op">(</span></span>
<span>  embedding_model <span class="op">=</span> <span class="va">embedding_model</span>,</span>
<span>  umap_model <span class="op">=</span> <span class="va">umap_model</span>,</span>
<span>  hdbscan_model <span class="op">=</span> <span class="va">hdbscan_model</span>,</span>
<span>  vectorizer_model <span class="op">=</span> <span class="va">vectorizer_model</span>,</span>
<span>  <span class="co"># zeroshot_topic_list = zeroshot_topic_list,</span></span>
<span>  <span class="co"># zeroshot_min_similarity = 0.85,</span></span>
<span>  representation_model <span class="op">=</span> <span class="va">representation_model</span>,</span>
<span>  calculate_probabilities <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  top_n_words <span class="op">=</span> <span class="fl">200L</span>, <span class="co"># if you need more top words, insert the desired number here!!!</span></span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-training">Model Training<a class="anchor" aria-label="anchor" href="#model-training"></a>
</h3>
<p>After all these preparational steps, the topic model is ready to be
trained with:
<code>topic_model$fit_transform(texts, embeddings)</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit the model and transform the texts</span></span>
<span><span class="va">fit_transform</span> <span class="op">&lt;-</span> <span class="va">topic_model</span><span class="op">$</span><span class="fu">fit_transform</span><span class="op">(</span><span class="va">texts_cleaned</span>, <span class="va">embeddings</span><span class="op">)</span></span>
<span><span class="va">topics</span> <span class="op">&lt;-</span> <span class="va">fit_transform</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Now transform the texts to get the updated probabilities</span></span>
<span><span class="va">transform_result</span> <span class="op">&lt;-</span> <span class="va">topic_model</span><span class="op">$</span><span class="fu">transform</span><span class="op">(</span><span class="va">texts_cleaned</span><span class="op">)</span></span>
<span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="va">transform_result</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>  <span class="co"># Extract the updated probabilities</span></span>
<span></span>
<span><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>We obtain the <em>topic labels</em> with
<code>topics &lt;- fit_transform[[1]]</code> and the <em>topic
probabilities</em> with <code>probs &lt;- fit_transform[[2]]</code>.</p>
</div>
<div class="section level3">
<h3 id="topic-dynamics">Topic Dynamics<a class="anchor" aria-label="anchor" href="#topic-dynamics"></a>
</h3>
<p>Since our dataset contains time-related metadata, we can use the
<code>timestamps</code> for <code>dynamic topic modeling</code>, i.e.,
for discovering topic development or topic sequences through time. If
your data doesn’t contain any time-related column, skip or disable the
timestamps and topics_over_time calculations.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Converting R Date to Python datetime</span></span>
<span><span class="va">datetime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/reticulate/reference/import.html" class="external-link">import</a></span><span class="op">(</span><span class="st">"datetime"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">timestamps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">date</span><span class="op">)</span></span>
<span><span class="co"># timestamps &lt;- as.integer(dataset$year)</span></span>
<span></span>
<span><span class="co"># Convert each R date object to an ISO 8601 string</span></span>
<span><span class="va">timestamps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">timestamps</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"%Y-%m-%dT%H:%M:%S"</span><span class="op">)</span>  <span class="co"># ISO 8601 format</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Dynamic topic model</span></span>
<span><span class="va">topics_over_time</span>  <span class="op">&lt;-</span> <span class="va">topic_model</span><span class="op">$</span><span class="fu">topics_over_time</span><span class="op">(</span><span class="va">texts_cleaned</span>, <span class="va">timestamps</span>, nr_bins<span class="op">=</span><span class="fl">20L</span>, global_tuning<span class="op">=</span><span class="cn">TRUE</span>, evolution_tuning<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="store-results">Store Results<a class="anchor" aria-label="anchor" href="#store-results"></a>
</h3>
<p>The <em>topic labels</em> and <em>probabilities</em> are stored in a
dataframe named <em>results</em>, together with other variables and
metadata.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Combine results with additional columns</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="va">dataset</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Topic <span class="op">=</span> <span class="va">topics</span>, </span>
<span>         Probability <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">probs</span>, <span class="fl">1</span>, <span class="va">max</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Assuming the highest probability for each sentence</span></span>
<span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="va">results</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>row_id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">row_id</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results</span>,<span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">rmarkdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgs.rstudio.com/rmarkdown/reference/paged_table.html" class="external-link">paged_table</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="st">"inst/extdata/spiegel_topic_results_df.rds"</span>, version <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">results</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="st">"inst/extdata/spiegel_topic_results_df.csv"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h2>
<p>The <code>R</code> package <code>bertopicr</code> will be used in
this section to display the topic modeling results in the form of lists,
data frames and visualizations. The names of the functions are nearly
the same as in the <code>Python</code> package
<code>BERTopic</code>.</p>
<div class="section level3">
<h3 id="document-information">Document information<a class="anchor" aria-label="anchor" href="#document-information"></a>
</h3>
<p>The <code><a href="../reference/get_document_info_df.html">get_document_info_df()</a></code> creates a dataframe that
contains the documents and associated topics, characteristic keywords,
probability scores, representative documents of a each topic and
representation model results (e.g., keywords extracted by
<code>KeyBERT</code>, <code>MMR</code>, <code>spacy</code>, and
<code>LLM</code> descriptions of the topics).</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">bertopicr</span><span class="op">)</span></span>
<span><span class="va">document_info_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_document_info_df.html">get_document_info_df</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">topic_model</span>, </span>
<span>                                         texts <span class="op">=</span> <span class="va">texts_cleaned</span>, </span>
<span>                                         drop_expanded_columns <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">document_info_df</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">rmarkdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgs.rstudio.com/rmarkdown/reference/paged_table.html" class="external-link">paged_table</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="representative-docs">Representative docs<a class="anchor" aria-label="anchor" href="#representative-docs"></a>
</h3>
<p>First, create a data frame similar to <em>df_docs</em> below, which
contains the columns Topic, Document and probs. Then use the
<code><a href="../reference/get_most_representative_docs.html">get_most_representative_docs()</a></code> function to extract
representative documents of a chosen topic.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a data frame similar to df_docs</span></span>
<span><span class="va">df_docs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>Topic <span class="op">=</span> <span class="va">results</span><span class="op">$</span><span class="va">Topic</span>,</span>
<span>                  Document <span class="op">=</span> <span class="va">results</span><span class="op">$</span><span class="va">text_clean</span>,</span>
<span>                  probs <span class="op">=</span> <span class="va">results</span><span class="op">$</span><span class="va">Probability</span><span class="op">)</span></span>
<span><span class="va">rep_docs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_most_representative_docs.html">get_most_representative_docs</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">df_docs</span>, </span>
<span>                                         topic_nr <span class="op">=</span> <span class="fl">3</span>, </span>
<span>                                         n_docs <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">rep_docs</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="topic-information">Topic information<a class="anchor" aria-label="anchor" href="#topic-information"></a>
</h3>
<p>The function <code><a href="../reference/get_topic_info_df.html">get_topic_info_df()</a></code> creates another useful
data frame, which for each of the extracted topics shows the number of
associated documents (or text chunks), topic id (Name), characeristic
keywords according to the chosen representation models and three
(concatenated) representative documents.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">topic_info_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_topic_info_df.html">get_topic_info_df</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">topic_model</span>, </span>
<span>                                   drop_expanded_columns <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">topic_info_df</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">rmarkdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgs.rstudio.com/rmarkdown/reference/paged_table.html" class="external-link">paged_table</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="words-in-topics">Words in Topics<a class="anchor" aria-label="anchor" href="#words-in-topics"></a>
</h3>
<p>The <code><a href="../reference/get_topics_df.html">get_topics_df()</a></code> function concentrates on the words
associated with a certain topic and their probability scores. The
outliers (Topic = -1) usually are not included in the analysis. But
BERTopic offers a function to reduce the number of outliers and to
update the topic model.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">topics_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_topics_df.html">get_topics_df</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">topic_model</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">topics_df</span>, <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="topic-barchart">Topic Barchart<a class="anchor" aria-label="anchor" href="#topic-barchart"></a>
</h3>
<p>The <code><a href="../reference/visualize_barchart.html">visualize_barchart()</a></code> creates an interactive barchart
with the top five words of the most frequently occurring topics.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/visualize_barchart.html">visualize_barchart</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">topic_model</span>, </span>
<span>                   filename <span class="op">=</span> <span class="st">"topics_topwords_interactive_barchart.html"</span>, <span class="co"># default</span></span>
<span>                   open_file <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># TRUE enables output in browser</span></span></code></pre></div>
<div class="float">
<img src="images/topics_topwords_interactive_barchart.png" alt="topics_topwords_interactive_barchart"><div class="figcaption">topics_topwords_interactive_barchart</div>
</div>
<p>We might prefer to create a customizable barchart with the
<code>ggplot2</code> package by using the dataframe extracted by the
<code><a href="../reference/get_topics_df.html">get_topics_df()</a></code> function and run the <code>plotly</code>
library in <code>R</code> with the <code>ggplotly()</code> function for
an interactive barchart. Due to possible conflicts between
<code>R</code>’s <code>plotly</code> library and <code>Python</code>’s
<code>plotly</code> implementation, the interactive barchart below is
disabled.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">barchart</span> <span class="op">&lt;-</span> <span class="va">topics_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Topic</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Topic</span> <span class="op">&gt;=</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">Topic</span> <span class="op">&lt;=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_head</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Topic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Topic"</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">Topic</span><span class="op">)</span><span class="op">)</span>, </span>
<span>         Word <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">Word</span>, <span class="va">Score</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">Score</span>, <span class="va">Word</span>, fill <span class="op">=</span> <span class="va">Topic</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Topic</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># # Disabled to avoid conflicts</span></span>
<span><span class="co"># library(plotly)</span></span>
<span><span class="co"># ggplotly(barchart)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="find-topics">Find Topics<a class="anchor" aria-label="anchor" href="#find-topics"></a>
</h3>
<p>The <code><a href="../reference/find_topics_df.html">find_topics_df()</a></code> function is useful for semantic
search. It can identify topics that are associated with a chosen query
or multiple queries.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/find_topics_df.html">find_topics_df</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">topic_model</span>, </span>
<span>               queries <span class="op">=</span> <span class="st">"migration"</span>, <span class="co"># user input</span></span>
<span>               top_n <span class="op">=</span> <span class="fl">10</span>, <span class="co"># default</span></span>
<span>               return_tibble <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># default</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/find_topics_df.html">find_topics_df</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">topic_model</span>, </span>
<span>                               queries <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"migranten"</span>, <span class="st">"asylanten"</span><span class="op">)</span>,</span>
<span>                               top_n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="get-topics">Get Topics<a class="anchor" aria-label="anchor" href="#get-topics"></a>
</h3>
<p>The <code><a href="../reference/get_topic_df.html">get_topic_df()</a></code> function creates a dataframe that
contains the top words extracted from a chosen topic.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_topic_df.html">get_topic_df</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">topic_model</span>, </span>
<span>                           topic_number <span class="op">=</span> <span class="fl">0</span>, </span>
<span>                           top_n <span class="op">=</span> <span class="fl">5</span>, <span class="co"># default is 10</span></span>
<span>                           return_tibble <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># default</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="topic-distribution">Topic Distribution<a class="anchor" aria-label="anchor" href="#topic-distribution"></a>
</h3>
<p>The <code><a href="../reference/visualize_distribution.html">visualize_distribution()</a></code> function produces an
interactive barchart that displays the associated topics of a chosen
document (or text chunk). The probability scores help to identify the
most likely topic(s) of a document (or text chunk).</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># default filename: topic_dist_interactive.html</span></span>
<span><span class="fu"><a href="../reference/visualize_distribution.html">visualize_distribution</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">topic_model</span>, </span>
<span>                       text_id <span class="op">=</span> <span class="fl">1</span>, <span class="co"># user input</span></span>
<span>                       probabilities <span class="op">=</span> <span class="va">probs</span><span class="op">)</span> <span class="co"># see model training</span></span></code></pre></div>
<div class="float">
<img src="images/topic_dist_interactive.png" alt="topic_dist_interactive"><div class="figcaption">topic_dist_interactive</div>
</div>
</div>
<div class="section level3">
<h3 id="intertopic-distance-map">Intertopic Distance Map<a class="anchor" aria-label="anchor" href="#intertopic-distance-map"></a>
</h3>
<p>The semantic relatedness or distance of topics can be displayed in
the form of a map with the <code><a href="../reference/visualize_topics.html">visualize_topics()</a></code> function.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/visualize_topics.html">visualize_topics</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">topic_model</span>, </span>
<span>                 filename <span class="op">=</span> <span class="st">"intertopic_distance_map"</span><span class="op">)</span> <span class="co"># default name</span></span></code></pre></div>
<div class="float">
<img src="images/intertopic_distance_map.png" alt="intertopic_distance_map"><div class="figcaption">intertopic_distance_map</div>
</div>
</div>
<div class="section level3">
<h3 id="topic-similarity">Topic Similarity<a class="anchor" aria-label="anchor" href="#topic-similarity"></a>
</h3>
<p>We can create a <code>similarity matrix</code> by applying cosine
similarities through the generated topic embeddings. The resulting
matrix indicates how similar topics are to each other. To visualize the
similarity matrix we can use the <code><a href="../reference/visualize_heatmap.html">visualize_heatmap()</a></code>
function.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/visualize_heatmap.html">visualize_heatmap</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">topic_model</span>, </span>
<span>                  filename <span class="op">=</span> <span class="st">"topics_similarity_heatmap"</span>, </span>
<span>                  auto_open <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="images/topics_similarity_heatmap.png" alt="topics_similarity_heatmap"><div class="figcaption">topics_similarity_heatmap</div>
</div>
</div>
<div class="section level3">
<h3 id="topic-hierarchy">Topic hierarchy<a class="anchor" aria-label="anchor" href="#topic-hierarchy"></a>
</h3>
<p>The best way to display the relatedness of documents (or text chunks)
is the <code><a href="../reference/visualize_hierarchy.html">visualize_hierarchy()</a></code> function, which creates an
interactive <code>dendrogram</code>.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/visualize_hierarchy.html">visualize_hierarchy</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">topic_model</span>, </span>
<span>                    hierarchical_topics <span class="op">=</span> <span class="cn">NULL</span>, <span class="co"># default</span></span>
<span>                    filename <span class="op">=</span> <span class="st">"topic_hierarchy"</span>, <span class="co"># default name, html extension</span></span>
<span>                    auto_open <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># TRUE enables output in browser</span></span></code></pre></div>
<p>An additional option is the creation of a
<code>hierarchical topics</code> list that can be included in the
interactive <code>dendrogram</code> and enables the user to identify
joint expressions.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hierarchical_topics</span> <span class="op">=</span> <span class="va">topic_model</span><span class="op">$</span><span class="fu">hierarchical_topics</span><span class="op">(</span><span class="va">texts_cleaned</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/visualize_hierarchy.html">visualize_hierarchy</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">topic_model</span>, </span>
<span>                    hierarchical_topics <span class="op">=</span> <span class="va">hierarchical_topics</span>,</span>
<span>                    filename <span class="op">=</span> <span class="st">"topic_hierarchy"</span>, <span class="co"># default name, html extension</span></span>
<span>                    auto_open <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># TRUE enables output in browser</span></span></code></pre></div>
<div class="float">
<img src="images/topic_hierarchy.png" alt="topic_hierarchy"><div class="figcaption">topic_hierarchy</div>
</div>
</div>
<div class="section level3">
<h3 id="visualize-documents">Visualize Documents<a class="anchor" aria-label="anchor" href="#visualize-documents"></a>
</h3>
<p>The <code><a href="../reference/visualize_documents.html">visualize_documents()</a></code> function displays the
identified clusters associated with a certain topic in two dimensions.
Usually, it is best to reduce the dimensionality of the embeddings with
<code>UMAP</code> (or another dimension reduction method) to produce
intelligible visual results. The interactive plot allows the user to
select one or more clusters with a double-click of the mouse.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Reduce dimensionality of embeddings using UMAP</span></span>
<span><span class="va">reduced_embeddings</span> <span class="op">&lt;-</span> <span class="va">umap</span><span class="op">$</span><span class="fu">UMAP</span><span class="op">(</span>n_neighbors <span class="op">=</span> <span class="fl">10L</span>, n_components <span class="op">=</span> <span class="fl">2L</span>, min_dist <span class="op">=</span> <span class="fl">0.0</span>, metric <span class="op">=</span> <span class="st">'cosine'</span><span class="op">)</span><span class="op">$</span><span class="fu">fit_transform</span><span class="op">(</span><span class="va">embeddings</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/visualize_documents.html">visualize_documents</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">topic_model</span>, </span>
<span>                    texts <span class="op">=</span> <span class="va">texts_cleaned</span>, </span>
<span>                    reduced_embeddings <span class="op">=</span> <span class="va">reduced_embeddings</span>, </span>
<span>                    filename <span class="op">=</span> <span class="st">"visualize_documents"</span>, <span class="co"># default extension html</span></span>
<span>                    auto_open <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># TRUE enables output in browser</span></span></code></pre></div>
<div class="float">
<img src="images/visualize_documents.png" alt="visualize_documents"><div class="figcaption">visualize_documents</div>
</div>
<p>After updating to <code>BERTopic=0.17.0</code>, you might experience
that the <code><a href="../reference/visualize_documents.html">visualize_documents()</a></code> function doesn’t render the
dots in the scatterplot. A simple <strong>temporary fix</strong> is to
open the <code>Python</code> file <code>_documents.py</code> of the
<code><a href="../reference/visualize_documents.html">visualize_documents()</a></code> function of<code>BERTopic</code> (on
my <code>Windows</code> system it sits in
<code>anaconda3\envs\bertopic\Lib\site-packages\bertopic\plotting\</code>)
and change <code>go.Scattergl</code> to <code>go.Scatter</code> in the
<code>fig.add_trace()</code> function (it occurs twice in the
<code>Python</code> script).</p>
<p>The <code><a href="../reference/visualize_documents_2d.html">visualize_documents_2d()</a></code> function is a variant of
the interactive plot above, but with additional <em>tooltips</em>. Set
<code>n_components</code> = 2L in <em>reduced_embeddings</em>!</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Reduce dimensionality of embeddings using UMAP (n_components = 2L !!!)</span></span>
<span><span class="va">reduced_embeddings</span> <span class="op">&lt;-</span> <span class="va">umap</span><span class="op">$</span><span class="fu">UMAP</span><span class="op">(</span>n_neighbors <span class="op">=</span> <span class="fl">10L</span>, n_components <span class="op">=</span> <span class="fl">2L</span>, min_dist <span class="op">=</span> <span class="fl">0.0</span>, metric <span class="op">=</span> <span class="st">'cosine'</span><span class="op">)</span><span class="op">$</span><span class="fu">fit_transform</span><span class="op">(</span><span class="va">embeddings</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/visualize_documents_2d.html">visualize_documents_2d</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">topic_model</span>, </span>
<span>                       texts <span class="op">=</span> <span class="va">texts_cleaned</span>, </span>
<span>                       reduced_embeddings <span class="op">=</span> <span class="va">reduced_embeddings</span>, </span>
<span>                       custom_labels <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># default</span></span>
<span>                       hide_annotation <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># default</span></span>
<span>                       tooltips <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Topic"</span>, <span class="st">"Name"</span>, <span class="st">"Probability"</span>, <span class="st">"Text"</span><span class="op">)</span>, <span class="co"># default</span></span>
<span>                       filename <span class="op">=</span> <span class="st">"visualize_documents_2d"</span>, <span class="co"># default name</span></span>
<span>                       auto_open <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># TRUE enables output in browser</span></span></code></pre></div>
<p>To create an interactive 3D plot, the
<code><a href="../reference/visualize_documents_3d.html">visualize_documents_3d()</a></code> function can be used. This
function is not implemented in the <code>Python</code> package. Set
<code>n_components</code> = 3L in <em>reduced_embeddings</em>!</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Reduce dimensionality of embeddings using UMAP</span></span>
<span><span class="va">reduced_embeddings</span> <span class="op">&lt;-</span> <span class="va">umap</span><span class="op">$</span><span class="fu">UMAP</span><span class="op">(</span>n_neighbors <span class="op">=</span> <span class="fl">10L</span>, n_components <span class="op">=</span> <span class="fl">3L</span>, min_dist <span class="op">=</span> <span class="fl">0.0</span>, metric <span class="op">=</span> <span class="st">'cosine'</span><span class="op">)</span><span class="op">$</span><span class="fu">fit_transform</span><span class="op">(</span><span class="va">embeddings</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/visualize_documents_3d.html">visualize_documents_3d</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">topic_model</span>, </span>
<span>                       texts <span class="op">=</span> <span class="va">texts_cleaned</span>, </span>
<span>                       reduced_embeddings <span class="op">=</span> <span class="va">reduced_embeddings</span>, </span>
<span>                       custom_labels <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># default</span></span>
<span>                       hide_annotation <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># default</span></span>
<span>                       tooltips <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Topic"</span>, <span class="st">"Name"</span>, <span class="st">"Probability"</span>, <span class="st">"Text"</span><span class="op">)</span>, <span class="co"># default</span></span>
<span>                       filename <span class="op">=</span> <span class="st">"visualize_documents_3d"</span>, <span class="co"># default name</span></span>
<span>                       auto_open <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># TRUE enables output in browser</span></span></code></pre></div>
<div class="float">
<img src="images/visualize_documents_3d.png" alt="visualize_documents_3d"><div class="figcaption">visualize_documents_3d</div>
</div>
<p>The legend of the <em>updated</em>
<code><a href="../reference/visualize_documents_3d.html">visualize_documents_3d()</a></code> function shows the Topic keywords
(<em>Name</em>) instead of the Topic number and includes a few
<em>tooltips</em>.</p>
</div>
<div class="section level3">
<h3 id="topic-development">Topic Development<a class="anchor" aria-label="anchor" href="#topic-development"></a>
</h3>
<p>We can also inspect how a chosen number of topics develop during a
certain period of time. The <code><a href="../reference/visualize_topics_over_time.html">visualize_topics_over_time()</a></code>
function assumes that the <code>timestamps</code>, the
<code>topic model</code> and the <code>topics over time model</code> are
already defined (e.g., in the model preparation step after topic model
training). The <code>timestamps</code> need to be <code>integers</code>
or in a a certain <code>date format</code> (see model preparation step
above).</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/visualize_topics_over_time.html">visualize_topics_over_time</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">topic_model</span>, </span>
<span>                           <span class="co"># see Topic Dynamics section above</span></span>
<span>                           topics_over_time_model <span class="op">=</span> <span class="va">topics_over_time</span>,</span>
<span>                           top_n_topics <span class="op">=</span> <span class="fl">10</span>, <span class="co"># default is 20</span></span>
<span>                           filename <span class="op">=</span> <span class="st">"topics_over_time"</span><span class="op">)</span> <span class="co"># default, html extension</span></span></code></pre></div>
<div class="float">
<img src="images/topics_over_time.png" alt="topics_over_time"><div class="figcaption">topics_over_time</div>
</div>
</div>
<div class="section level3">
<h3 id="groups">Groups<a class="anchor" aria-label="anchor" href="#groups"></a>
</h3>
<p>If our dataset includes categorical variables (groups, classes,
etc.), we can use the <code><a href="../reference/visualize_topics_per_class.html">visualize_topics_per_class()</a></code> function
to display an interactive barchart with the groups or classes associated
with a chosen topic. With a double-click of the mouse, the user can
choose a single topic and inspect the frequency of the groups.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">classes</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">genre</span><span class="op">)</span> <span class="co"># text types</span></span>
<span><span class="va">topics_per_class</span> <span class="op">=</span> <span class="va">topic_model</span><span class="op">$</span><span class="fu">topics_per_class</span><span class="op">(</span><span class="va">texts_cleaned</span>, classes<span class="op">=</span><span class="va">classes</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/visualize_topics_per_class.html">visualize_topics_per_class</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">topic_model</span>, </span>
<span>                           topics_per_class <span class="op">=</span> <span class="va">topics_per_class</span>,</span>
<span>                           start <span class="op">=</span> <span class="fl">0</span>, <span class="co"># default</span></span>
<span>                           end <span class="op">=</span> <span class="fl">10</span>, <span class="co"># default</span></span>
<span>                           filename <span class="op">=</span> <span class="st">"topics_per_class"</span>, <span class="co"># default, html extension </span></span>
<span>                           auto_open <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># TRUE enables output in browser</span></span></code></pre></div>
<div class="float">
<img src="images/topics_per_class.png" alt="topics_per_class"><div class="figcaption">topics_per_class</div>
</div>
<p>We could also use the <code>ggplot2</code> and <code>plotly</code>
packages in <code>R</code> to produce a similar looking customized
interactive barchart.</p>
</div>
</div>
<div class="section level2">
<h2 id="wordcloud">Wordcloud<a class="anchor" aria-label="anchor" href="#wordcloud"></a>
</h2>
<p>Wordclouds are not implemented in <code>BERTopic</code>, but it is
possible to extract the top n words from a topic. First, spin up a new
<code>BERTopic</code> model with <code>top_n = 200L</code> (i.e., the
200 most frequent words).</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">BERTopic200</span> <span class="op">&lt;-</span> <span class="va">bertopic</span><span class="op">$</span><span class="va">BERTopic</span></span>
<span><span class="va">topic_model200</span> <span class="op">&lt;-</span> <span class="fu">BERTopic200</span><span class="op">(</span></span>
<span>  embedding_model <span class="op">=</span> <span class="va">embedding_model</span>,</span>
<span>  umap_model <span class="op">=</span> <span class="va">umap_model</span>,</span>
<span>  hdbscan_model <span class="op">=</span> <span class="va">hdbscan_model</span>,</span>
<span>  vectorizer_model <span class="op">=</span> <span class="va">vectorizer_model</span>,</span>
<span>  <span class="co"># zeroshot_topic_list = zeroshot_topic_list,</span></span>
<span>  <span class="co"># zeroshot_min_similarity = 0.85,</span></span>
<span>  representation_model <span class="op">=</span> <span class="va">representation_model</span>,</span>
<span>  calculate_probabilities <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  top_n_words <span class="op">=</span> <span class="fl">200L</span>, <span class="co"># !!!</span></span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit the model and transform the texts</span></span>
<span><span class="va">py_fit</span> <span class="op">&lt;-</span> <span class="va">topic_model200</span><span class="op">$</span><span class="fu">fit</span><span class="op">(</span><span class="va">texts_cleaned</span>, <span class="va">embeddings</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ask Python for the top-200 of the desired topic:</span></span>
<span><span class="va">py_topic200</span> <span class="op">&lt;-</span> <span class="va">py_fit</span><span class="op">$</span><span class="fu">get_topic</span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">200L</span><span class="op">)</span>    <span class="co"># list of (word, score)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">py_topic200</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rep_list</span> <span class="op">&lt;-</span> <span class="va">py_topic200</span><span class="op">[[</span><span class="st">"Main"</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Then create a dataframe to plot a wordcloud.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_wc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">rep_list</span>, <span class="va">`[[`</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  freq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">rep_list</span>, <span class="va">`[[`</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lchiffon/wordcloud2" class="external-link">wordcloud2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"inst/extdata/wordcloud2a.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">wordcloud2a</span><span class="op">(</span></span>
<span>  data            <span class="op">=</span> <span class="va">df_wc</span>,</span>
<span>  size            <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  minSize         <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  gridSize        <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  fontFamily      <span class="op">=</span> <span class="st">"Segoe UI"</span>,</span>
<span>  fontWeight      <span class="op">=</span> <span class="st">"bold"</span>,</span>
<span>  color           <span class="op">=</span> <span class="st">"random-dark"</span>,</span>
<span>  backgroundColor <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>  shape           <span class="op">=</span> <span class="st">"circle"</span>,</span>
<span>  ellipticity     <span class="op">=</span> <span class="fl">0.65</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p><code>BERTopic</code> is an awesome topic modeling package in Python.
The <code>bertopicr</code> package tries to bring some of the
functionalities into an <code>R</code> programming environment with the
magnificent <code>reticulate</code> package as interface to the
<code>Python</code> backend.</p>
<p><code>BERTopic</code> offers a number of additional functions, which
might be included in subsequent versions of <code>bertopicr</code>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Teodor Petrič.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
